<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>
<!-- Load d3-annotation -->
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>


<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>



      <style>
      body {
        margin: 0 auto;
        display: table;
        
      }
      .fitted {
        stroke-width: 2.5px;
        stroke: steelblue;
        stroke-dasharray: 10,10;
      }
      .text {
         font-size: 13px;
         margin-top: 10px;
         text-align: center;
      }
      </style>
<div id="option">
    <input name="updateButton" 
           type="button" 
           value="Click Here To Continue" 
           onclick="changeFilter()" />
</div>

<script>
var click_num=0;
var click_var=0;
color = ['orange','red','blue'];

renderGraph(click_num)





function changeFilter() {
   var svg = d3.select("#my_dataviz")
   //.append("svg")
   svg.selectAll('*').remove();
    // Get the data again


     //d3.select('svg').html = "";
         console.log(click_num)
    click_num=click_num+1;
    renderGraph(click_num)
}


function renderGraph(_clicknum) {
console.log("RENDERING")
// set the dimensions and margins of the graph
var margin = {top: 10, right: 30, bottom: 30, left: 60},
    width = 460 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

//Read the data
console.log(click_num^2)
click_var=0
d3.csv('https://johnjdambra.github.io/Education_Data_Clean.csv', function(data) {
  if (_clicknum!=0 & _clicknum<=3) {
  data=data.filter(function(d) { return d.SCHTYPE == _clicknum })
  click_var=click_num
}

   //Calculate line of best fit
   var x_mean=0;
   var y_mean=0;
   x_mean=d3.mean(data,function(d){return +d.COSTT4_A;})
   y_mean=d3.mean(data,function(d){return +d.MD_EARN_WNE_P10;})
   //for (i in data){
 // console.log(data.forEach(function(d){return d.COSTT4_A;}));
//}
console.log(y_mean);
var xy_diff=d3.sum(data,function(d){return (+d.COSTT4_A-x_mean)*(+d.MD_EARN_WNE_P10-y_mean);});
var xx_diff=d3.sum(data,function(d){return (+d.COSTT4_A-x_mean)* (+d.COSTT4_A-x_mean);});
var fit_slope=xy_diff/xx_diff
var b_intercept=y_mean-fit_slope*x_mean;
console.log(fit_slope)
console.log(b_intercept)


  // Add X axis
  var x = d3.scaleLinear(y_mean)
    .domain([0, 96375])
    .range([ 0, width ]);
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x));

  // Add Y axis
  var y = d3.scaleLinear()
    .domain([0, 250000])
    .range([ height, 0]);
  svg.append("g")
    .call(d3.axisLeft(y));

  // Add dots
  svg.append('g')
    .selectAll("dot")
    .data(data)
    .enter()
    .append("circle")
      //.filter(function(d) { return d.SCHTYPE == 1 })

      .attr("cx", function (d) { return x(d.COSTT4_A); } )
  //                   .transition()
      //               .delay(1000)
    //  .duration(1000)
      .attr("cy", function (d) { return y(d.MD_EARN_WNE_P10); } )
      .attr("r", 2)
      .attr("fill",  function (d) { if(_clicknum==0){return 'Purple'}else{ return color[+d.SCHTYPE-1];} })



//Add line of best fit
var x1_pt=0
var x2_pt=100000
 svg.append('line')
    .attr("class", "fitted")
    .attr('x1',x(x1_pt))
    .attr('x2',x(x2_pt))
    .attr('y1',y(fit_slope*x1_pt+b_intercept))
    .attr('y2',y(fit_slope*x2_pt+b_intercept)) 

 var schools=['all','Public','Private, Nonprofit','Proprietary']
 var y_placements=[-70,-30,-50,-70]
 //Add annotation
 annotations = [
  {
    note: {
      label: "For "+schools[click_var]+" schools, an additional $1 spent on cost results in an additional $"+fit_slope.toFixed(2)+" of future earnings",
      title: "Estimated Value"
    },
    x: x(x2_pt),
    y: y((fit_slope*x2_pt+b_intercept)),
    dy: y_placements[click_var],
    dx: -20
  }
]

// Add annotation to the chart
 makeAnnotations = d3.annotation()
  .annotations(annotations)
//d3.select("#my_dataviz")
  svg.append("g")
  .call(makeAnnotations)





})

}






</script>